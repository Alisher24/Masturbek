<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Авторизация</title>
    <link rel="stylesheet" href="{% static 'css/bootstrap-reboot.min.css'%}">
    <link rel="stylesheet" href="{% static 'css/bootstrap-grid.min.css'%}">
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css'%}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css'%}"/>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>

<body>
  <center style="padding-top: 10px;"><h1>АВТОРИЗАЦИЯ</h1></center>
  <a href=".." class="LogoInRecipe"><img src="{% static 'icons/logo.jpg'%}" alt="лого"></a>
<!-- HTML-разметка для модального окна -->
<div class="modal fade" id="error-modal" tabindex="-1" role="dialog" aria-labelledby="error-modal-label" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modal-title">Ошибка</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p id="error-modal-message"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
      </div>
    </div>
  </div>
</div>
<div class="MainContentOfAuth">
  
    <div class="container">
        <div class="row">
            <br>
            <ul class="nav nav-pills nav-justified mb-3" id="ex1" role="tablist">
                <li class="nav-item" role="presentation">
                  <a class="nav-link active" id="tab-login" data-mdb-toggle="pill" href="#pills-login" role="tab"
                    aria-controls="pills-login" aria-selected="true">Войти</a>
                </li>
                <li class="nav-item" role="presentation">
                  <a class="nav-link" id="tab-register" data-mdb-toggle="pill" href="#pills-register" role="tab"
                    aria-controls="pills-register" aria-selected="false">Зарегистрироваться</a>
                </li>
              </ul>

            <!-- Pills content -->
            <div class="tab-content">
                <div class="tab-pane fade show active" id="pills-login" role="tabpanel" aria-labelledby="tab-login">

                    <form method="POST" id="login-form">
                        {{ registration }}
                        {% csrf_token %}

                        <!-- Username input -->
                        <div class="form-outline mb-4">
                            <input type="text" id="username" class="form-control" name="username"/>
                            <label class="form-label" for="username">Никнэйм</label>
                        </div>

                        <!-- Password input -->
                        <div class="form-outline mb-4">
                            <input type="password" id="password" class="form-control" name="password"/>
                            <label class="form-label" for="password">Пароль</label>
                        </div>

                        <!-- 2 column grid layout -->
                        <div class="row mb-4">
                            <div class="col-md-6 d-flex justify-content-center">
                                <!-- Checkbox -->
                                <div class="form-check mb-3 mb-md-0">
                                    <input class="form-check-input" type="checkbox" value="" id="loginCheck" checked/>
                                    <label class="form-check-label" for="loginCheck"> Запомнить меня </label>
                                </div>
                            </div>
                        </div>

                        <!-- Submit button -->
                        <button type="submit" class="btn btn-primary btn-block mb-4" name="login_button">Войти</button>

                    </form>

                </div>
                <div class="tab-pane fade" id="pills-register" role="tabpanel" aria-labelledby="tab-register">
{#                    <div id="error-message" style="display: none;"></div>#}
                    <form method="POST" id="register-form">
                          {% csrf_token %}
                        <!-- Name input -->
                        <div class="form-outline mb-4">
                          <input type="text" id="first_name" class="form-control" name="first_name" />
                          <label class="form-label" for="first_name">Имя</label>
                        </div>

                        <!-- Username input -->
                        <div class="form-outline mb-4">
                          <input type="text" id="username_register" name="username_register" class="form-control" />
                          <label class="form-label" for="username_register">Никнэйм</label>
                        </div>

                        <!-- Email input -->
                        <div class="form-outline mb-4">
                          <input type="email" id="email" name="email" class="form-control" />
                          <label class="form-label" for="email">Почта</label>
                        </div>

                        <!-- Password input -->
                        <div class="form-outline mb-4">
                          <input type="password" id="password_first" name="password_first" class="form-control" />
                          <label class="form-label" for="password_first">Пароль</label>
                        </div>

                        <!-- Repeat Password input -->
                        <div class="form-outline mb-4">
                          <input type="password" id="repeat_password" name="repeat_password" class="form-control" />
                          <label class="form-label" for="repeat_password">Повторите пароль</label>
                        </div>

                        <!-- Checkbox -->
      

                        <!-- Submit button -->
                        <button type="submit" class="btn btn-primary btn-block mb-3" name="register_button">Зарегистрироваться</button>

                    </form>
                </div>

            </div>
        </div>
    </div>
</div>
{#{% load static %}#}
<script src="{% static 'js/script.js' %}"></script>

<script>
$(document).ready(function() {
  $('#register-form, #login-form').submit(function(event) {
    event.preventDefault();

    // Получаем данные формы
    var formData = $(this).serializeArray();

    // Определяем тип операции
    var operation = '';
    if ($(this).attr('id') === 'register-form') {
      operation = 'register';
    } else if ($(this).attr('id') === 'login-form') {
      operation = 'login';
    }

    // Добавляем информацию о нажатой кнопке
    formData.push({name: operation + '_button', value: 'true'});

    $.ajax({
      url: this.action,
      type: 'POST',
      data: formData,
      dataType: 'json',
      success: function(response) {
        // Обработка успешного ответа от сервера
        window.location.href = '/profile/'; // Перенаправление на страницу профиля
      },
      error: function(xhr, errmsg, err) {
        // Обработка ошибки
        var errorResponse = xhr.responseText;
        var modalTitle = (operation === 'register') ? 'Ошибка регистрации' : 'Ошибка авторизации';
        $('#modal-title').text(modalTitle);
        $('#error-modal-message').text(errorResponse);
        $('#error-modal').modal('show'); // Открываем модальное окно с ошибкой
      }
    });
  });
});
</script>

</body>

</html>